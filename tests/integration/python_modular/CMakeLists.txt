INCLUDE(PythonEnvironment)
GET_PYTHON_ENV()

FOREACH(TEST_SRC ${INTEGRATION_TESTS})
	STRING(REGEX REPLACE ".*/(.*).m" "\\1" TEST_NAME ${TEST_SRC})
	add_test(NAME integration-python_modular-${TEST_NAME}
		WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
		COMMAND ${PYTHON_EXECUTABLE} test_one.py ${TEST_SRC})
	set_property(TEST integration-python_modular-${TEST_NAME} PROPERTY
		ENVIRONMENT "${PYTHON_ENV_VARS}")
ENDFOREACH()

FILE(GLOB PYTHON_MODULAR_INTEGRATION_TESTS tests/*.py)
FOREACH(TEST_SRC ${PYTHON_MODULAR_INTEGRATION_TESTS})
	STRING(REGEX REPLACE ".*/(.*).py" "\\1" TEST_NAME ${TEST_SRC})
	add_test(NAME integration-python_modular-tester-${TEST_NAME}
		WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
		COMMAND ${PYTHON_EXECUTABLE} tester.py ${TEST_NAME}.py)
	set_property(TEST integration-python_modular-tester-${TEST_NAME} PROPERTY
		ENVIRONMENT "${PYTHON_ENV_VARS}")
ENDFOREACH()
