LIST(APPEND ENV_VARS GDB="gdb -x ${CMAKE_SOURCE_DIR}/src/.gdb --args")
LIST(APPEND ENV_VARS PYTHON=${PYTHON_EXECUTABLE})
LIST(APPEND ENV_VARS PYTHONPATH=${CMAKE_INSTALL_PREFIX}/${PYTHON_PACKAGES_PATH})
if(WIN32)
  LIST(APPEND ENV_VARS PATH=${CMAKE_INSTALL_PREFIX}/lib;$ENV{PATH})
elseif(APPLE)
  LIST(APPEND ENV_VARS DYLD_LIBRARY_PATH=${CMAKE_INSTALL_PREFIX}/lib:$ENV{DYLD_LIBRARY_PATH})
else()
  LIST(APPEND ENV_VARS LD_LIBRARY_PATH=${CMAKE_INSTALL_PREFIX}/lib:$ENV{LD_LIBRARY_PATH})
endif()

FILE(GLOB PYTHON_EXAMPLES *.py)
FOREACH(EXAMPLE ${PYTHON_EXAMPLES})
	STRING(REGEX REPLACE ".*/(.*).py" "\\1" EXAMPLE_NAME ${EXAMPLE})
	add_test(NAME python_modular-${EXAMPLE_NAME}
			WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
			COMMAND ${PYTHON_EXECUTABLE} ${EXAMPLE})
	set_property(TEST python_modular-${EXAMPLE_NAME} PROPERTY
				ENVIRONMENT "${ENV_VARS}")

ENDFOREACH()